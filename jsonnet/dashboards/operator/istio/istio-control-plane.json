{
  "kind": "PersesDashboard",
  "apiVersion": "perses.dev/v1alpha1",
  "metadata": {
    "name": "istio-control-plane",
    "namespace": "perses-dev",
    "creationTimestamp": null,
    "labels": {
      "app.kubernetes.io/component": "dashboard",
      "app.kubernetes.io/instance": "istio-control-plane",
      "app.kubernetes.io/name": "perses-dashboard",
      "app.kubernetes.io/part-of": "perses-operator"
    }
  },
  "spec": {
    "display": {
      "name": "Istio Control Plane Dashboard"
    },
    "panels": {
      "0_0": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "Pilot Versions",
            "description": "Istio pilot versions running."
          },
          "plugin": {
            "kind": "TimeSeriesChart",
            "spec": {
              "legend": {
                "position": "bottom",
                "mode": "list"
              },
              "yAxis": {
                "format": {
                  "unit": "decimal"
                }
              },
              "visual": {
                "display": "line",
                "lineWidth": 0.25,
                "areaOpacity": 0.5,
                "palette": {
                  "mode": "auto"
                }
              }
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource",
                      "name": "prometheus-datasource"
                    },
                    "query": "sum by (tag) (istio_build{component=\"pilot\"})",
                    "seriesNameFormat": "Version ({{tag}})"
                  }
                }
              }
            }
          ]
        }
      },
      "1_0": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "Memory Usage",
            "description": "Memory usage of each running instance"
          },
          "plugin": {
            "kind": "TimeSeriesChart",
            "spec": {
              "legend": {
                "position": "bottom",
                "mode": "table",
                "values": [
                  "last",
                  "max"
                ]
              },
              "yAxis": {
                "format": {
                  "unit": "bytes"
                }
              },
              "visual": {
                "display": "line",
                "lineWidth": 1,
                "areaOpacity": 0.1,
                "palette": {
                  "mode": ""
                }
              }
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource",
                      "name": "prometheus-datasource"
                    },
                    "query": "sum by (pod) (container_memory_working_set_bytes{container=\"discovery\",pod=~\"istiod-.*\"})",
                    "seriesNameFormat": "Container ({{pod}})"
                  }
                }
              }
            },
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource",
                      "name": "prometheus-datasource"
                    },
                    "query": "sum by (pod) (go_memstats_stack_inuse_bytes{app=\"istiod\"})",
                    "seriesNameFormat": "Stack ({{pod}})"
                  }
                }
              }
            },
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource",
                      "name": "prometheus-datasource"
                    },
                    "query": "sum by (pod) (go_memstats_heap_inuse_bytes{app=\"istiod\"})",
                    "seriesNameFormat": "Heap (In Use) ({{pod}})"
                  }
                }
              }
            },
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource",
                      "name": "prometheus-datasource"
                    },
                    "query": "sum by (pod) (go_memstats_heap_alloc_bytes{app=\"istiod\"})",
                    "seriesNameFormat": "Heap (Allocated) ({{pod}})"
                  }
                }
              }
            }
          ]
        }
      },
      "1_1": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "Memory Allocations",
            "description": "Details about memory allocations"
          },
          "plugin": {
            "kind": "TimeSeriesChart",
            "spec": {
              "legend": {
                "position": "bottom",
                "mode": "table",
                "values": [
                  "last",
                  "max"
                ]
              },
              "yAxis": {
                "format": {
                  "unit": "bytes/sec"
                }
              },
              "visual": {
                "display": "line",
                "lineWidth": 1,
                "areaOpacity": 0.1,
                "palette": {
                  "mode": ""
                }
              }
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource",
                      "name": "prometheus-datasource"
                    },
                    "query": "sum by (pod) (rate(go_memstats_alloc_bytes_total{app=\"istiod\"}[$__rate_interval]))",
                    "seriesNameFormat": "Bytes ({{pod}})"
                  }
                }
              }
            },
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource",
                      "name": "prometheus-datasource"
                    },
                    "query": "sum by (pod) (rate(go_memstats_mallocs_total{app=\"istiod\"}[$__rate_interval]))",
                    "seriesNameFormat": "Objects ({{pod}})"
                  }
                }
              }
            }
          ]
        }
      },
      "1_2": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "CPU Usage",
            "description": "CPU usage of each running instance"
          },
          "plugin": {
            "kind": "TimeSeriesChart",
            "spec": {
              "legend": {
                "position": "bottom",
                "mode": "table",
                "values": [
                  "last",
                  "max"
                ]
              },
              "visual": {
                "display": "line",
                "lineWidth": 1,
                "areaOpacity": 0.1,
                "palette": {
                  "mode": ""
                }
              }
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource",
                      "name": "prometheus-datasource"
                    },
                    "query": "sum by (pod) (\n  irate(container_cpu_usage_seconds_total{container=\"discovery\",pod=~\"istiod-.*\"}[$__rate_interval])\n)",
                    "seriesNameFormat": "Container ({{pod}})"
                  }
                }
              }
            }
          ]
        }
      },
      "1_3": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "Goroutines",
            "description": "Goroutine count for each running instance"
          },
          "plugin": {
            "kind": "TimeSeriesChart",
            "spec": {
              "legend": {
                "position": "bottom",
                "mode": "table",
                "values": [
                  "last",
                  "max"
                ]
              },
              "visual": {
                "display": "line",
                "lineWidth": 1,
                "areaOpacity": 0.1,
                "palette": {
                  "mode": ""
                }
              }
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource",
                      "name": "prometheus-datasource"
                    },
                    "query": "sum by (pod) (go_goroutines{app=\"istiod\"})",
                    "seriesNameFormat": "Goroutines ({{pod}})"
                  }
                }
              }
            }
          ]
        }
      },
      "2_0": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "XDS Pushes",
            "description": "Rate of XDS pushes by type."
          },
          "plugin": {
            "kind": "TimeSeriesChart",
            "spec": {
              "legend": {
                "position": "bottom",
                "mode": "list"
              },
              "yAxis": {
                "format": {
                  "unit": "decimal"
                }
              },
              "visual": {
                "display": "line",
                "lineWidth": 0.25,
                "areaOpacity": 0.5,
                "palette": {
                  "mode": "auto"
                },
                "stack": "all"
              }
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource",
                      "name": "prometheus-datasource"
                    },
                    "query": "sum by (type) (irate(pilot_xds_pushes[$__rate_interval]))",
                    "seriesNameFormat": "{{type}}"
                  }
                }
              }
            }
          ]
        }
      },
      "2_1": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "Events",
            "description": "Events from Kubernetes API server."
          },
          "plugin": {
            "kind": "TimeSeriesChart",
            "spec": {
              "legend": {
                "position": "bottom",
                "mode": "list"
              },
              "yAxis": {
                "format": {
                  "unit": "decimal"
                }
              },
              "visual": {
                "display": "line",
                "lineWidth": 0.25,
                "areaOpacity": 0.5,
                "palette": {
                  "mode": "auto"
                },
                "stack": "all"
              }
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource",
                      "name": "prometheus-datasource"
                    },
                    "query": "sum by (type, event) (rate(pilot_k8s_reg_events[$__rate_interval]))",
                    "seriesNameFormat": "{{type}} {{event}}"
                  }
                }
              }
            },
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource",
                      "name": "prometheus-datasource"
                    },
                    "query": "sum by (type, event) (rate(pilot_k8s_cfg_events[$__rate_interval]))",
                    "seriesNameFormat": "{{type}} {{event}}"
                  }
                }
              }
            },
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource",
                      "name": "prometheus-datasource"
                    },
                    "query": "sum by (type) (rate(pilot_push_triggers[$__rate_interval]))",
                    "seriesNameFormat": "{{type}}"
                  }
                }
              }
            }
          ]
        }
      },
      "2_2": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "Connections",
            "description": "Number of connections to Istiod."
          },
          "plugin": {
            "kind": "TimeSeriesChart",
            "spec": {
              "legend": {
                "position": "bottom",
                "mode": "list"
              },
              "yAxis": {
                "format": {
                  "unit": "decimal"
                }
              },
              "visual": {
                "display": "line",
                "lineWidth": 0.25,
                "areaOpacity": 0.5,
                "palette": {
                  "mode": "auto"
                }
              }
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource",
                      "name": "prometheus-datasource"
                    },
                    "query": "sum by (tag) (istio_build{component=\"pilot\"})"
                  }
                }
              }
            }
          ]
        }
      },
      "2_3": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "Push Errors",
            "description": "Errors pushing to Envoy."
          },
          "plugin": {
            "kind": "TimeSeriesChart",
            "spec": {
              "legend": {
                "position": "bottom",
                "mode": "list"
              },
              "yAxis": {
                "format": {
                  "unit": "decimal"
                }
              },
              "visual": {
                "display": "line",
                "lineWidth": 0.25,
                "areaOpacity": 0.5,
                "palette": {
                  "mode": "auto"
                },
                "stack": "all"
              }
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource",
                      "name": "prometheus-datasource"
                    },
                    "query": "sum by (type) (pilot_total_xds_rejects)",
                    "seriesNameFormat": "Rejected: {{type}}"
                  }
                }
              }
            },
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource",
                      "name": "prometheus-datasource"
                    },
                    "query": "pilot_total_xds_internal_errors",
                    "seriesNameFormat": "Internal Error"
                  }
                }
              }
            }
          ]
        }
      },
      "2_4": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "Push Time",
            "description": "Count of active and pending proxies managed by each instance.\nPending is expected to converge to zero."
          },
          "plugin": {
            "kind": "TimeSeriesChart",
            "spec": {
              "legend": {
                "position": "bottom",
                "mode": "list"
              },
              "yAxis": {
                "format": {
                  "unit": "milliseconds"
                }
              },
              "visual": {
                "display": "line",
                "lineWidth": 0.25,
                "areaOpacity": 0.5,
                "palette": {
                  "mode": "auto"
                }
              }
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource",
                      "name": "prometheus-datasource"
                    },
                    "query": "sum by (le) (rate(pilot_xds_push_time_bucket[1m]))",
                    "seriesNameFormat": "{{le}}"
                  }
                }
              }
            }
          ]
        }
      },
      "2_5": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "Push Size",
            "description": "Size of each xDS push."
          },
          "plugin": {
            "kind": "TimeSeriesChart",
            "spec": {
              "legend": {
                "position": "bottom",
                "mode": "list"
              },
              "yAxis": {
                "format": {
                  "unit": "bytes"
                }
              },
              "visual": {
                "display": "line",
                "lineWidth": 0.25,
                "areaOpacity": 0.5,
                "palette": {
                  "mode": "auto"
                }
              }
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource",
                      "name": "prometheus-datasource"
                    },
                    "query": "sum by (le) (rate(pilot_xds_config_size_bytes_bucket[1m]))",
                    "seriesNameFormat": "{{le}}"
                  }
                }
              }
            }
          ]
        }
      },
      "3_0": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "Validation",
            "description": "Webhook validation success/failure rate."
          },
          "plugin": {
            "kind": "TimeSeriesChart",
            "spec": {
              "legend": {
                "position": "bottom",
                "mode": "list"
              },
              "yAxis": {
                "format": {
                  "unit": "decimal"
                }
              },
              "visual": {
                "display": "line",
                "lineWidth": 0.25,
                "areaOpacity": 0.5,
                "palette": {
                  "mode": "auto"
                },
                "stack": "all"
              }
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource",
                      "name": "prometheus-datasource"
                    },
                    "query": "sum(rate(galley_validation_passed[1m]))",
                    "seriesNameFormat": "Passed"
                  }
                }
              }
            },
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource",
                      "name": "prometheus-datasource"
                    },
                    "query": "sum(rate(galley_validation_failed[1m]))",
                    "seriesNameFormat": "Failed"
                  }
                }
              }
            }
          ]
        }
      },
      "3_1": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "Injection",
            "description": "Webhook injection success/failure rate."
          },
          "plugin": {
            "kind": "TimeSeriesChart",
            "spec": {
              "legend": {
                "position": "bottom",
                "mode": "list"
              },
              "yAxis": {
                "format": {
                  "unit": "decimal"
                }
              },
              "visual": {
                "display": "line",
                "lineWidth": 0.25,
                "areaOpacity": 0.5,
                "palette": {
                  "mode": "auto"
                },
                "stack": "all"
              }
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource",
                      "name": "prometheus-datasource"
                    },
                    "query": "sum(rate(sidecar_injection_success_total[1m]))",
                    "seriesNameFormat": "Success"
                  }
                }
              }
            },
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource",
                      "name": "prometheus-datasource"
                    },
                    "query": "sum(rate(sidecar_injection_failure_total[1m]))",
                    "seriesNameFormat": "Failure"
                  }
                }
              }
            }
          ]
        }
      }
    },
    "layouts": [
      {
        "kind": "Grid",
        "spec": {
          "display": {
            "title": "Deployed Versions"
          },
          "items": [
            {
              "x": 0,
              "y": 0,
              "width": 24,
              "height": 5,
              "content": {
                "$ref": "#/spec/panels/0_0"
              }
            }
          ]
        }
      },
      {
        "kind": "Grid",
        "spec": {
          "display": {
            "title": "Resource Usage"
          },
          "items": [
            {
              "x": 0,
              "y": 0,
              "width": 6,
              "height": 10,
              "content": {
                "$ref": "#/spec/panels/1_0"
              }
            },
            {
              "x": 6,
              "y": 0,
              "width": 6,
              "height": 10,
              "content": {
                "$ref": "#/spec/panels/1_1"
              }
            },
            {
              "x": 12,
              "y": 0,
              "width": 6,
              "height": 10,
              "content": {
                "$ref": "#/spec/panels/1_2"
              }
            },
            {
              "x": 18,
              "y": 0,
              "width": 6,
              "height": 10,
              "content": {
                "$ref": "#/spec/panels/1_3"
              }
            }
          ]
        }
      },
      {
        "kind": "Grid",
        "spec": {
          "display": {
            "title": "Push Information"
          },
          "items": [
            {
              "x": 0,
              "y": 0,
              "width": 8,
              "height": 10,
              "content": {
                "$ref": "#/spec/panels/2_0"
              }
            },
            {
              "x": 8,
              "y": 0,
              "width": 8,
              "height": 10,
              "content": {
                "$ref": "#/spec/panels/2_1"
              }
            },
            {
              "x": 16,
              "y": 0,
              "width": 8,
              "height": 10,
              "content": {
                "$ref": "#/spec/panels/2_2"
              }
            },
            {
              "x": 0,
              "y": 10,
              "width": 8,
              "height": 10,
              "content": {
                "$ref": "#/spec/panels/2_3"
              }
            },
            {
              "x": 8,
              "y": 10,
              "width": 8,
              "height": 10,
              "content": {
                "$ref": "#/spec/panels/2_4"
              }
            },
            {
              "x": 16,
              "y": 10,
              "width": 8,
              "height": 10,
              "content": {
                "$ref": "#/spec/panels/2_5"
              }
            }
          ]
        }
      },
      {
        "kind": "Grid",
        "spec": {
          "display": {
            "title": "Webhooks"
          },
          "items": [
            {
              "x": 0,
              "y": 0,
              "width": 12,
              "height": 8,
              "content": {
                "$ref": "#/spec/panels/3_0"
              }
            },
            {
              "x": 12,
              "y": 0,
              "width": 12,
              "height": 8,
              "content": {
                "$ref": "#/spec/panels/3_1"
              }
            }
          ]
        }
      }
    ],
    "duration": "1h"
  },
  "status": {}
}