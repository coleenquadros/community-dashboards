{
  "kind": "PersesDashboard",
  "apiVersion": "perses.dev/v1alpha1",
  "metadata": {
    "name": "istio-control-plane",
    "namespace": "perses-dev",
    "creationTimestamp": null,
    "labels": {
      "app.kubernetes.io/component": "dashboard",
      "app.kubernetes.io/instance": "istio-control-plane",
      "app.kubernetes.io/name": "perses-dashboard",
      "app.kubernetes.io/part-of": "perses-operator"
    }
  },
  "spec": {
    "display": {
      "name": "Istio / Control Plane"
    },
    "variables": [
      {
        "kind": "ListVariable",
        "spec": {
          "display": {
            "name": "cluster",
            "hidden": false
          },
          "allowAllValue": false,
          "allowMultiple": true,
          "plugin": {
            "kind": "PrometheusLabelValuesVariable",
            "spec": {
              "datasource": {
                "kind": "PrometheusDatasource",
                "name": "prometheus-datasource"
              },
              "labelName": "cluster",
              "matchers": [
                "pilot_build_info{}"
              ]
            }
          },
          "name": "cluster"
        }
      },
      {
        "kind": "ListVariable",
        "spec": {
          "display": {
            "name": "namespace",
            "hidden": false
          },
          "allowAllValue": false,
          "allowMultiple": false,
          "plugin": {
            "kind": "PrometheusLabelValuesVariable",
            "spec": {
              "datasource": {
                "kind": "PrometheusDatasource",
                "name": "prometheus-datasource"
              },
              "labelName": "namespace",
              "matchers": [
                "pilot_build_info{cluster=\"$cluster\"}"
              ]
            }
          },
          "name": "namespace"
        }
      }
    ],
    "panels": {
      "0_0": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "Push Size",
            "description": "Size of each xDS push."
          },
          "plugin": {
            "kind": "TimeSeriesChart",
            "spec": {
              "legend": {
                "position": "bottom",
                "mode": "list"
              },
              "yAxis": {
                "format": {
                  "unit": "bytes"
                }
              },
              "visual": {
                "display": "line",
                "lineWidth": 0.25,
                "areaOpacity": 0.5,
                "palette": {
                  "mode": "auto"
                }
              }
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource",
                      "name": "prometheus-datasource"
                    },
                    "query": "sum by (le) (rate(pilot_xds_config_size_bytes_bucket[1m]))",
                    "seriesNameFormat": "{{le}}"
                  }
                }
              }
            }
          ]
        }
      },
      "0_1": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "Push Time",
            "description": "Count of active and pending proxies managed by each instance.\nPending is expected to converge to zero."
          },
          "plugin": {
            "kind": "TimeSeriesChart",
            "spec": {
              "legend": {
                "position": "bottom",
                "mode": "list"
              },
              "yAxis": {
                "format": {
                  "unit": "milliseconds"
                }
              },
              "visual": {
                "display": "line",
                "lineWidth": 0.25,
                "areaOpacity": 0.5,
                "palette": {
                  "mode": "auto"
                }
              }
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource",
                      "name": "prometheus-datasource"
                    },
                    "query": "sum by (le) (rate(pilot_xds_push_time_bucket[1m]))",
                    "seriesNameFormat": "{{le}}"
                  }
                }
              }
            }
          ]
        }
      },
      "0_2": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "Connections",
            "description": "Number of connections to Istiod."
          },
          "plugin": {
            "kind": "TimeSeriesChart",
            "spec": {
              "legend": {
                "position": "bottom",
                "mode": "list"
              },
              "yAxis": {
                "format": {
                  "unit": "decimal"
                }
              },
              "visual": {
                "display": "line",
                "lineWidth": 0.25,
                "areaOpacity": 0.5,
                "palette": {
                  "mode": "auto"
                }
              }
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource",
                      "name": "prometheus-datasource"
                    },
                    "query": "sum(pilot_xds)"
                  }
                }
              }
            }
          ]
        }
      },
      "1_0": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "CPU Usage",
            "description": "CPU usage for Istiod processes."
          },
          "plugin": {
            "kind": "TimeSeriesChart",
            "spec": {
              "legend": {
                "position": "bottom",
                "mode": "list"
              },
              "yAxis": {
                "format": {
                  "unit": "percent"
                }
              },
              "visual": {
                "display": "line",
                "lineWidth": 0.25,
                "areaOpacity": 0.5,
                "palette": {
                  "mode": "auto"
                }
              }
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource",
                      "name": "prometheus-datasource"
                    },
                    "query": "rate(process_cpu_seconds_total{job=\"istiod\"}[1m]) * 100",
                    "seriesNameFormat": "{{instance}}"
                  }
                }
              }
            }
          ]
        }
      },
      "1_1": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "Memory Usage",
            "description": "Memory usage for Istiod processes."
          },
          "plugin": {
            "kind": "TimeSeriesChart",
            "spec": {
              "legend": {
                "position": "bottom",
                "mode": "list"
              },
              "yAxis": {
                "format": {
                  "unit": "bytes"
                }
              },
              "visual": {
                "display": "line",
                "lineWidth": 0.25,
                "areaOpacity": 0.5,
                "palette": {
                  "mode": "auto"
                }
              }
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource",
                      "name": "prometheus-datasource"
                    },
                    "query": "go_memstats_alloc_bytes{job=\"istiod\"}",
                    "seriesNameFormat": "{{instance}}"
                  }
                }
              }
            }
          ]
        }
      },
      "1_2": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "Memory Allocations",
            "description": "Memory allocation rate for Istiod processes."
          },
          "plugin": {
            "kind": "TimeSeriesChart",
            "spec": {
              "legend": {
                "position": "bottom",
                "mode": "list"
              },
              "yAxis": {
                "format": {
                  "unit": "bytes/sec"
                }
              },
              "visual": {
                "display": "line",
                "lineWidth": 0.25,
                "areaOpacity": 0.5,
                "palette": {
                  "mode": "auto"
                }
              }
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource",
                      "name": "prometheus-datasource"
                    },
                    "query": "rate(go_memstats_alloc_bytes_total{job=\"istiod\"}[1m])",
                    "seriesNameFormat": "{{instance}}"
                  }
                }
              }
            }
          ]
        }
      },
      "2_0": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "Events",
            "description": "Events from Kubernetes API server."
          },
          "plugin": {
            "kind": "TimeSeriesChart",
            "spec": {
              "legend": {
                "position": "bottom",
                "mode": "list"
              },
              "yAxis": {
                "format": {
                  "unit": "decimal"
                }
              },
              "visual": {
                "display": "line",
                "lineWidth": 0.25,
                "areaOpacity": 0.5,
                "palette": {
                  "mode": "auto"
                },
                "stack": "all"
              }
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource",
                      "name": "prometheus-datasource"
                    },
                    "query": "sum by (type, event) (rate(pilot_k8s_reg_events[$__rate_interval]))",
                    "seriesNameFormat": "{{type}} {{event}}"
                  }
                }
              }
            },
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource",
                      "name": "prometheus-datasource"
                    },
                    "query": "sum by (type, event) (rate(pilot_k8s_cfg_events[$__rate_interval]))",
                    "seriesNameFormat": "{{type}} {{event}}"
                  }
                }
              }
            },
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource",
                      "name": "prometheus-datasource"
                    },
                    "query": "sum by (type) (rate(pilot_push_triggers[$__rate_interval]))",
                    "seriesNameFormat": "{{type}}"
                  }
                }
              }
            }
          ]
        }
      },
      "2_1": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "Goroutines",
            "description": "Number of goroutines in Istiod processes."
          },
          "plugin": {
            "kind": "TimeSeriesChart",
            "spec": {
              "legend": {
                "position": "bottom",
                "mode": "list"
              },
              "yAxis": {
                "format": {
                  "unit": "decimal"
                }
              },
              "visual": {
                "display": "line",
                "lineWidth": 0.25,
                "areaOpacity": 0.5,
                "palette": {
                  "mode": "auto"
                }
              }
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource",
                      "name": "prometheus-datasource"
                    },
                    "query": "go_goroutines{job=\"istiod\"}",
                    "seriesNameFormat": "{{instance}}"
                  }
                }
              }
            }
          ]
        }
      },
      "3_0": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "Injection",
            "description": "Webhook injection success/failure rate."
          },
          "plugin": {
            "kind": "TimeSeriesChart",
            "spec": {
              "legend": {
                "position": "bottom",
                "mode": "list"
              },
              "yAxis": {
                "format": {
                  "unit": "decimal"
                }
              },
              "visual": {
                "display": "line",
                "lineWidth": 0.25,
                "areaOpacity": 0.5,
                "palette": {
                  "mode": "auto"
                },
                "stack": "all"
              }
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource",
                      "name": "prometheus-datasource"
                    },
                    "query": "sum(rate(sidecar_injection_success_total[1m]))",
                    "seriesNameFormat": "Success"
                  }
                }
              }
            },
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource",
                      "name": "prometheus-datasource"
                    },
                    "query": "sum(rate(sidecar_injection_failure_total[1m]))",
                    "seriesNameFormat": "Failure"
                  }
                }
              }
            }
          ]
        }
      },
      "3_1": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "Validation",
            "description": "Webhook validation success/failure rate."
          },
          "plugin": {
            "kind": "TimeSeriesChart",
            "spec": {
              "legend": {
                "position": "bottom",
                "mode": "list"
              },
              "yAxis": {
                "format": {
                  "unit": "decimal"
                }
              },
              "visual": {
                "display": "line",
                "lineWidth": 0.25,
                "areaOpacity": 0.5,
                "palette": {
                  "mode": "auto"
                },
                "stack": "all"
              }
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource",
                      "name": "prometheus-datasource"
                    },
                    "query": "sum(rate(galley_validation_passed[1m]))",
                    "seriesNameFormat": "Passed"
                  }
                }
              }
            },
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource",
                      "name": "prometheus-datasource"
                    },
                    "query": "sum(rate(galley_validation_failed[1m]))",
                    "seriesNameFormat": "Failed"
                  }
                }
              }
            }
          ]
        }
      },
      "4_0": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "Pilot Versions",
            "description": "Istio pilot versions running."
          },
          "plugin": {
            "kind": "TimeSeriesChart",
            "spec": {
              "legend": {
                "position": "bottom",
                "mode": "list"
              },
              "yAxis": {
                "format": {
                  "unit": "decimal"
                }
              },
              "visual": {
                "display": "line",
                "lineWidth": 0.25,
                "areaOpacity": 0.5,
                "palette": {
                  "mode": "auto"
                }
              }
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource",
                      "name": "prometheus-datasource"
                    },
                    "query": "sum by (tag) (pilot_build_info)",
                    "seriesNameFormat": "{{tag}}"
                  }
                }
              }
            }
          ]
        }
      },
      "4_1": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "Push Errors",
            "description": "Errors pushing to Envoy."
          },
          "plugin": {
            "kind": "TimeSeriesChart",
            "spec": {
              "legend": {
                "position": "bottom",
                "mode": "list"
              },
              "yAxis": {
                "format": {
                  "unit": "decimal"
                }
              },
              "visual": {
                "display": "line",
                "lineWidth": 0.25,
                "areaOpacity": 0.5,
                "palette": {
                  "mode": "auto"
                },
                "stack": "all"
              }
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource",
                      "name": "prometheus-datasource"
                    },
                    "query": "sum by (type) (pilot_total_xds_rejects)",
                    "seriesNameFormat": "Rejected: {{type}}"
                  }
                }
              }
            },
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource",
                      "name": "prometheus-datasource"
                    },
                    "query": "pilot_total_xds_internal_errors",
                    "seriesNameFormat": "Internal Error"
                  }
                }
              }
            }
          ]
        }
      },
      "4_2": {
        "kind": "Panel",
        "spec": {
          "display": {
            "name": "XDS Pushes",
            "description": "Rate of XDS pushes by type."
          },
          "plugin": {
            "kind": "TimeSeriesChart",
            "spec": {
              "legend": {
                "position": "bottom",
                "mode": "list"
              },
              "yAxis": {
                "format": {
                  "unit": "decimal"
                }
              },
              "visual": {
                "display": "line",
                "lineWidth": 0.25,
                "areaOpacity": 0.5,
                "palette": {
                  "mode": "auto"
                },
                "stack": "all"
              }
            }
          },
          "queries": [
            {
              "kind": "TimeSeriesQuery",
              "spec": {
                "plugin": {
                  "kind": "PrometheusTimeSeriesQuery",
                  "spec": {
                    "datasource": {
                      "kind": "PrometheusDatasource",
                      "name": "prometheus-datasource"
                    },
                    "query": "sum by (type) (irate(pilot_xds_pushes[$__rate_interval]))",
                    "seriesNameFormat": "{{type}}"
                  }
                }
              }
            }
          ]
        }
      }
    },
    "layouts": [
      {
        "kind": "Grid",
        "spec": {
          "display": {
            "title": "Control Plane Metrics"
          },
          "items": [
            {
              "x": 0,
              "y": 0,
              "width": 8,
              "height": 8,
              "content": {
                "$ref": "#/spec/panels/0_0"
              }
            },
            {
              "x": 8,
              "y": 0,
              "width": 8,
              "height": 8,
              "content": {
                "$ref": "#/spec/panels/0_1"
              }
            },
            {
              "x": 16,
              "y": 0,
              "width": 8,
              "height": 8,
              "content": {
                "$ref": "#/spec/panels/0_2"
              }
            }
          ]
        }
      },
      {
        "kind": "Grid",
        "spec": {
          "display": {
            "title": "Resource Usage"
          },
          "items": [
            {
              "x": 0,
              "y": 0,
              "width": 8,
              "height": 8,
              "content": {
                "$ref": "#/spec/panels/1_0"
              }
            },
            {
              "x": 8,
              "y": 0,
              "width": 8,
              "height": 8,
              "content": {
                "$ref": "#/spec/panels/1_1"
              }
            },
            {
              "x": 16,
              "y": 0,
              "width": 8,
              "height": 8,
              "content": {
                "$ref": "#/spec/panels/1_2"
              }
            }
          ]
        }
      },
      {
        "kind": "Grid",
        "spec": {
          "display": {
            "title": "Events"
          },
          "items": [
            {
              "x": 0,
              "y": 0,
              "width": 12,
              "height": 8,
              "content": {
                "$ref": "#/spec/panels/2_0"
              }
            },
            {
              "x": 12,
              "y": 0,
              "width": 12,
              "height": 8,
              "content": {
                "$ref": "#/spec/panels/2_1"
              }
            }
          ]
        }
      },
      {
        "kind": "Grid",
        "spec": {
          "display": {
            "title": "Operations"
          },
          "items": [
            {
              "x": 0,
              "y": 0,
              "width": 12,
              "height": 8,
              "content": {
                "$ref": "#/spec/panels/3_0"
              }
            },
            {
              "x": 12,
              "y": 0,
              "width": 12,
              "height": 8,
              "content": {
                "$ref": "#/spec/panels/3_1"
              }
            }
          ]
        }
      },
      {
        "kind": "Grid",
        "spec": {
          "display": {
            "title": "Status"
          },
          "items": [
            {
              "x": 0,
              "y": 0,
              "width": 8,
              "height": 8,
              "content": {
                "$ref": "#/spec/panels/4_0"
              }
            },
            {
              "x": 8,
              "y": 0,
              "width": 8,
              "height": 8,
              "content": {
                "$ref": "#/spec/panels/4_1"
              }
            },
            {
              "x": 16,
              "y": 0,
              "width": 8,
              "height": 8,
              "content": {
                "$ref": "#/spec/panels/4_2"
              }
            }
          ]
        }
      }
    ],
    "duration": "1h"
  },
  "status": {}
}